import{h as S,n as I}from"./q-B9R08C_P.js";import{_hW as U}from"./q-B9R08C_P.js";import{_ as A}from"./q-L4XZ6hCu.js";import{F as R}from"./q-CcsipMCw.js";var b=class{},w;A(()=>import("./q-BIHI7g3E.js"),[]).then(t=>{const n=t.AsyncLocalStorage;w=new n,globalThis.qcAsyncRequestStore=w}).catch(t=>{console.warn("AsyncLocalStorage not available, continuing without it. This might impact concurrent server calls.",t)});var O=/^\d+$/u,P=/^-?\d*(\.\d+)?$/u,G=/^\d{4}-(?:0[1-9]|1[0-2])-(?:[12]\d|0[1-9]|3[01])$/u,F=/^\d{4}-(?:0[1-9]|1[0-2])-(?:[12]\d|0[1-9]|3[01])T(?:0\d|1\d|2[0-3]):[0-5]\d$/u,X=/^(?:0\d|1\d|2[0-3]):[0-5]\d$/u,x=/^(?:0\d|1\d|2[0-3])(?::[0-5]\d){2}$/u,K=/^\d{4}-W(?:0[1-9]|[1-4]\d|5[0-3])$/u;function T(t){if(!t||t==="null")return null;if(t!=="undefined"){if(G.test(t))return new Date(`${t}T00:00:00.000Z`);if(F.test(t))return new Date(`${t}:00.000Z`);if(K.test(t)){const[n,a]=t.split("-W"),e=new Date(`${n}-01-01T00:00:00.000Z`);return e.setUTCDate((+a-1)*7+1),e}return X.test(t)?new Date(`1970-01-01T${t}:00.000Z`):x.test(t)?new Date(`1970-01-01T${t}.000Z`):O.test(t)?new Date(+t):new Date(t)}}function M(t){if(!t||t==="null")return null;if(t!=="undefined")return!(t==="false"||t==="off"||t==="0")}function L(t){if(!t||t==="null")return null;if(t!=="undefined")return P.test(t)?Number(t):T(t).getTime()}function W(t,n,a){var e,l,c;if((e=t==null?void 0:t.booleans)!=null&&e.includes(n))return M(a);if(typeof a=="string"){if((l=t==null?void 0:t.dates)!=null&&l.includes(n))return T(a);if((c=t==null?void 0:t.numbers)!=null&&c.includes(n))return L(a)}return a}function E(t,n,a){return t.reduce((e,l,c)=>e[l]=e[l]||(n[c+1]==="$"?[]:{}),a)}function D(t,n){const a=[];if(t.includes(".$.")){const e=(l,c)=>{const[u,...s]=l.split(".$."),i=c?`${c}.${u}`:u,d=E(i.split("."),l.split("."),n);for(let o=0;o<d.length;o++){const r=`${i}.${o}`;s.length>1?e(s.join(".$."),r):a.push(`${r}.${s[0]}`)}};e(t)}else a.push(t);return a}function Z(t,n,a){var u;const[e,l]=typeof n=="function"?[void 0,n]:[n,a];if(e)for(const s of["arrays","booleans","dates","files","numbers"])(u=e[s])!=null&&u.length&&(e[s]=e[s].map(i=>i.replace(/\[\$\]/g,".$")));const c={};for(const[s,i]of t.entries()){const d=s.replace(/\[(\d+)\]/g,".$1"),o=d.replace(/\.\d+\./g,".$.").replace(/\.\d+$/,".$"),r=o.split(".");d.split(".").reduce((f,p,g,$)=>{var m,_,y;if(g<$.length-1){if(f[p])return f[p];const h=g<$.length-2?r[g+1]==="$":(m=e==null?void 0:e.arrays)==null?void 0:m.includes(r.slice(0,-1).join("."));return f[p]=h?[]:{}}if(!((_=e==null?void 0:e.files)!=null&&_.includes(o))||i&&(typeof i=="string"||i.size)){let h=W(e,o,i);l&&(h=l({path:s,input:i,output:h})),(y=e==null?void 0:e.arrays)!=null&&y.includes(o)?f[p]?f[p].push(h):f[p]=[h]:f[p]=h}},c)}if(e!=null&&e.arrays)for(const s of e.arrays){const i=D(s,c);for(const d of i){const o=d.split("."),r=o[o.length-1],f=E(o.slice(0,-1),s.split("."),c);f[r]||(f[r]=[])}}if(e!=null&&e.booleans)for(const s of e.booleans){const i=D(s,c);for(const d of i){const o=d.split("."),r=o[o.length-1],f=E(o.slice(0,-1),s.split("."),c);f[r]!==!0&&(f[r]=!1)}}return c}const V=async(t,n)=>{var o;const[a,e]=S(),{validate:l,...c}=typeof e=="object"?e:{validate:e},u=(o=n.request.headers.get("content-type"))==null?void 0:o.split(/[;,]/,1)[0],s=u==="application/x-www-form-urlencoded"||u==="multipart/form-data"?Z(n.sharedMap.get("@actionFormData"),c,({output:r})=>r instanceof Blob?I(r):r):t,i=l?await l(s):{};let d={values:s,errors:i,response:{}};if(!Object.keys(i).length)try{const r=await a(s,n);r&&typeof r=="object"&&(d={values:s,errors:r.errors||{},response:{status:r.status,message:r.message,data:r.data}})}catch(r){if(r instanceof b)throw r;console.error(r),r instanceof R?d={values:s,errors:r.errors,response:{status:"error",message:r.message}}:d.response={status:"error",message:"An unknown error has occurred."}}return d};export{U as _hW,V as s_gjcHf0ES4W4};
